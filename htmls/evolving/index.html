<!DOCTYPE html>
<html>
<head>
	<title>e</title>
	<link rel="stylesheet" type="text/css" href="../../css/reset.css">
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<style type="text/css">
		@import url(http://fonts.googleapis.com/css?family=Lato:400,100,100italic,300,300italic,700,400italic,700italic,900,900italic);
		html,body {
			background: #efefef;
			margin: 0;
			padding: 0;
			background-image:url(data:image/png;base64,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);
		}
		#stage,canvas {
			
			margin: 0;
			padding: 0;
			overflow: hidden;
		}
		h1 {
			position: absolute;
			bottom: 12px;
			right: 12px;
			font-size: 28px;
			font-family: Droid Sans, Helvetica Neue, Lato, sans-serif;
			font-weight: light;
			pointer-events: none;
		}
	</style>
	<script type="text/javascript">
	var app = {
		
		num_cubes: 60,
		cubes: [],
		fps: 30,
		num_layers: 300,
		ratioX: 0,
		ratioY: 0,
		
		pallete: [
			'181,32,32',
			'84,32,32',
			'192,32,32',
			'133,32,32',
			'210,32,32',
			'255,12,12',
			'12,192,192'
		],
		
		init: function(){
			var self = this;
			self.cubes = [];
			$("#stage,canvas").css({
				height: $(window).height(),
				width: $(window).width(),
			});


			self.$obj = $('canvas');
			
			self.$obj.attr({
				height: $(window).height(),
				width: $(window).width(),
			});

			self.$obj.bind('mousemove mouseout mousedown mouseup',self.handler);
			self.width = self.$obj.width(); 
			self.height = self.$obj.height();

			self.ctx 		= self.$obj[0].getContext('2d');
			self.ctx.font 	= "9px Lato";
			var factors 	= this.facs = this.factors(self.width,12);
			var csize 		= 38;//factors[factors.length-1] || 12;
			
			var column 		= self.width / csize << 0;
			var row 		= self.height / csize << 0;

			self.num_cubes = column*row;



			var y = 0;
			var x = 0;
			self.start_osc = self.osc(-0.2,0.2,0.001);

			for (var i = 0; i < self.num_cubes; i++) {

				var colour = app.pallete[ Math.random() * app.pallete.length << 0];

				if ((self.cubes.length) % column != 0) {
					x += csize;
				} else {
					x = 0;
				}
				
				

				self.cubes.push(
					new Cube({
						x: 		x+1,
						y: 		y+1,
						size: 	csize-2,
						colour: colour,
						layer:  (Math.random() * app.num_layers)<< 0 ,
						start_value: self.start_osc()
					})
				);

				if (self.cubes.length % column == 0 ) {
					y += csize;
				} 
				
			};


			window.clearInterval(self.interval);
			self.interval = window.setInterval(self.anim, 1000/self.fps);


		},
		factors: function(whole,min,max){

			var min = min == undefined ? 1 : min;
			var max = max == undefined ? whole/2 : max;

			var factors = [];

			for (var i = min; i < max; i++) {
				if (whole % i == 0) {
					factors.push(i);
				};
			};

			return factors;

		},
		handler: function(e){
			var self = app;

			switch(e.type){
				case 'mousedown':
					this.enable = true;

					break;
				case 'mouseup':
				case 'mouseout':
					this.enable = false;
					self.ratioX = 0;
					self.ratioY = 0;
					break;
				case 'mousemove':
					if (!this.enable) {
						return;
					};
					self.lastX = e.offsetX;
					self.lastY = e.offsetY;

					self.ratioX = self.lastX / app.width - 1;
					self.ratioY = self.lastY / app.height - 1;
					break;
			}
			


		},
		anim: function(){
			var self = app;
			
			self.draw();

		},
		draw: function(){
			var self = app;
			var ctx = self.ctx;

		   	ctx.clearRect(0, 0, self.width, self.height);
		    self.ctx.save();

		    // self.ctx.translate( 100, 100 );

		    
		    for (var i = 0; i < self.cubes.length; i++) {
		    	self.cubes[i].draw();
		    };
		   	// self.ctx.rotate(Math.PI * 0.001);
		    self.ctx.restore();

		    
		},
		osc: function(low, high, inc, reverse, start_value) {

		    // basic test for illegal parameters
		    if (low > high || inc < 0 ||  2 * (high - low) < inc){
		        return function() { return NaN; };
		    }
		        

		   var curr = reverse ? low : high;

		    if (start_value) {
		    	curr = start_value;
		    	// console.log('init with '+start_value);
		    };

		    

		    return function() {
		        var ret = curr;
		        curr += inc;

		        if (curr > high || curr < low) 
		        {   
		            curr = inc > 0 ? 2 * high - curr : 2 * low - curr;  
		            inc = -inc;
		        };
		       
		        return parseFloat(ret).toFixed(2); 
		        return ret;
		        
		    }; 
		}
	}

	function Cube(options){

		var self = this;
		var ctx = app.ctx;

		self.index = app.cubes.length;
		self.x = options.x;
		self.y = options.y;
		self.size = options.size;
		self.layer = options.layer;
		self.osc = app.osc(-0.2,0.2,0.002,self.index%2==0 ? false : true);
		self.scale = self.layer+1/app.num_layers;
		self.transparency = app.num_layers/self.layer-0.5 ;


		this.draw = function(){
			this.update();
			ctx.translate(app.width / 4, app.height / 4);
			ctx.rotate(Math.PI / 0.232);
			ctx.fillText(self.index +" // " +self.fac.toFixed(2), this.x, this.y - 5);
			ctx.fillStyle = "rgba("+options.colour+","+self.transparency+")";
    		ctx.fillRect(this.x, this.y, this.size, this.size);
		}

		this.update = function(){

			var fac = this.fac = parseFloat(self.osc());
			switch(self.index-1  % 2){
				case 0:
					fac = fac*Math.sin(self.index)
					break;
				
				case 1:
					fac = fac*Math.cos(self.index)
					break;

				
				

			}
			// console.log(fac);

			self.x += fac + self.scale * app.ratioX;
			self.y += fac + self.scale * app.ratioY;

			// self.x += fac;
			// self.y += fac;
			self.size += fac;



			
			
			
		}
	}

	$(function(){
		$(window).resize(function(){
			app.init();	
		});

		$(window).trigger('resize');
	});

	</script>

</head>
<body>

	<div id="stage">
		<canvas width="500" height="500"></canvas>
	</div>
	<h1>Resize me, click me</h1>

</body>
</html>
